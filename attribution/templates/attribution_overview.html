{% extends "layout.html" %}
{% load staticfiles %}
{% load i18n %}

{% comment "License" %}
* OSIS stands for Open Student Information System. It's an application
* designed to manage the core business of higher education institutions,
* such as universities, faculties, institutes and professional schools.
* The core business involves the administration of students, teachers,
* courses, programs and so on.
*
* Copyright (C) 2015-2017 Universit√© catholique de Louvain (http://www.uclouvain.be)
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* A copy of this license - GNU General Public License - is available
* at the root of the source code of this program.  If not,
* see http://www.gnu.org/licenses/.
{% endcomment %}

{% block breadcrumb_area %}
<ol class="breadcrumb">
    <li><a href="{% url 'dashboard_home' %}" id="lnk_home_osis"><span class="glyphicon glyphicon-home"
                                                                      aria-hidden="true"></span></a></li>
    {% block breadcrumb %}
        <li>{% trans 'my_applications' %}</li>
    {% endblock %}
    <a href="http://uclouvain.github.io/osis/assets/user_manual_portal_fr.pdf"
       target="help" id="lnk_user_manual_section"><span
            class="glyphicon glyphicon-question-sign pull-right"
            style="font-size: 14pt; color: green"
            aria-hidden="true"></span></a>
</ol>
{% endblock %}

{% block content %}
    <small style="color:black;font-family:Verdana;" class="pull-right">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% trans 'application_period'%}{{ application_academic_calendar.start_date | default_if_none:''|date:"d/m/Y"}} {% trans 'to' %} {{ application_academic_calendar.end_date | default_if_none:''|date:"d/m/Y" }}</small>
    <h1>{% trans 'my_applications' %}</h1>
    <h2>{{ a_tutor.person.first_name }} {{ a_tutor.person.last_name }} - {{ a_tutor.person.global_id }}</h2>

    {% include "template_messages.html" %}

    <div class="panel panel-default" id="pnl_applications">
        <div class="panel-heading">{% trans 'my_applications'%} {{ application_year }}</div>
        <div class="panel-body">
            <div class="clearfix">
                {% if applications %}
                <span class="pull-right" style="margin-left:10px;margin-right:10px;">
                    <form action="{% url 'email_tutor_application_confirmation' %}"
                          method="POST"
                          id="form_email_tutor_application_confirmation">
                        {% csrf_token %}
                        <button class="btn btn-default"
                                id="btn_applications_email_confirmtion"
                                type="submit" title="{%trans 'confirm_applications_by_mail'%}">
                            <span class="glyphicon glyphicon-envelope" ></span></button>
                    </form>
                </span>
                {% endif %}
                <a id="lnk_submit_attribution_new" class="btn btn-primary pull-right"
                   href="{% url 'vacant_attributions_search'%}">
                    <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
                    {% trans 'create_an_tutor_application' %}
                </a>
            </div>
            <br>
        {% if applications %}
            {% include "applications_list.html" with applications=applications %}
        {% else %}
            <div class="alert alert-info" style="margin-top:10px;">{%  trans 'no_tutor_application' %}</div>
        {% endif %}
        </div>
    </div>

    {% if attributions_about_to_expire %}
    <div class="panel panel-default" id="pnl_charges_about_to_expire">
        <div class="panel-heading">{% trans 'my_charges_vacant'%} {% trans 'without_application' %} {{ current_academic_year }}</div>
        <div class="panel-body">
            {% include "attribution_renewal_list.html" with attributions=attributions_about_to_expire %}
            <br>
        </div>
    </div>
    {% endif %}

    <div class="panel panel-default" id="pnl_charges">
        <div class="panel-heading">{% trans 'my_charges'%} {{ application_year }}</div>
        <div class="panel-body">
            {% if attributions %}
                {% include "attribution_list.html" with attributions=attributions %}
                <br>
            {% endif %}
        </div>
    </div>

{% endblock %}

{% block script %}
    <script type="text/javascript">
        $('document').ready(function(){
            var recompute_submit_renew_btn_and_select_all_state = function(){
               // Submit button
               var submit_renew_btn = $("#bt_submit_attribution_renew");
               var checkboxes_checked = $('input:checkbox[id^="chb_attribution_renew_"]:checked');
               submit_renew_btn.prop('disabled', checkboxes_checked.length == 0);

               // Select all checkbox
               var select_all_chb =  $("#chb_renew_all");
               var checkboxes_enabled = $('input:checkbox[id^="chb_attribution_renew_"]:enabled');
               if (checkboxes_checked.length == checkboxes_enabled.length && checkboxes_enabled.length > 0){
                    select_all_chb.prop('checked', true);
               }else {
                    select_all_chb.prop('checked', false);
               }
            };

            var select_all_chb =  $("#chb_renew_all");
            var checkboxes_enabled = $('input:checkbox[id^="chb_attribution_renew_"]:enabled');
            if (checkboxes_enabled.length > 0) {
                select_all_chb.attr('disabled', false);
                select_all_chb.click(function() {
                    is_checked = $(this).prop('checked');
                    checkboxes_enabled.prop('checked', is_checked);
                    recompute_submit_renew_btn_and_select_all_state();
                });
                checkboxes_enabled.each(function(){
                    $(this).click(recompute_submit_renew_btn_and_select_all_state);
                });
            }
            recompute_submit_renew_btn_and_select_all_state();

            $("button[id^='lnk_application_delete_']").click(function() {
                return confirm(gettext('confirm_application_delete'));
            });
        });

        function changeOrientation(button) {
            if (button.className.includes("glyphicon-collapse-down") {
                button.className = button.className.replace("glyphicon-collapse-down", "glyphicon-expand");
            }
            else if (button.className.includes("glyphicon-expand") {
                button.className = button.className.replace("glyphicon-expand", "glyphicon-collapse-down");
            }
        }

    </script>
{% endblock %}