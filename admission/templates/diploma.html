{% load staticfiles %}
{% load i18n %}
{% load dictionnary %}
{% load get_at_index %}

{% comment "License" %}
* OSIS stands for Open Student Information System. It's an application
* designed to manage the core business of higher education institutions,
* such as universities, faculties, institutes and professional schools.
* The core business involves the administration of students, teachers,
* courses, programs and so on.
*
* Copyright (C) 2015-2016 Université catholique de Louvain (http://www.uclouvain.be)
*
* This program is free software: you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation, either version 3 of the License, or
* (at your option) any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* A copy of this license - GNU General Public License - is available
* at the root of the source code of this program.  If not,
* see http://www.gnu.org/licenses/.
{% endcomment %}

<form method="post" action="{% url 'diploma'%}" id="form_secondary_education">
    <input type="hidden"
           id="hdn_diploma"
           name="diploma"
           value="{{secondary_education.diploma | default_if_none:'False'}}" >
    <input type="hidden"
           id="hdn_secondary_education_academic_year_id"
           name="secondary_academic_year"
           value="{{secondary_education.academic_year.id}}" >
    <input type="hidden"
           id="hdn_secondary_education_national"
           name="secondary_education_national"
           value="{{secondary_education.national | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_community"
           value="{{secondary_education.national_community | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_id"
           name="secondary_education_national_institution_id"
           value="{{secondary_education.national_institution.id | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_city"
           name="secondary_education_national_institution_city"
           value="{{secondary_education.national_institution.city}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_postal_code"
           name="secondary_education_national_institution_postal_code"
           value="{{secondary_education.national_institution.postal_code}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_name"
           name="secondary_education_national_institution_name"
           value="{{secondary_education.national_institution.name}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_adhoc"
           value="{{secondary_education.national_institution.adhoc| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_national_institution_national_community"
           name="secondary_education_national_institution_national_community"
           value="{{secondary_education.national_institution.national_community| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_education_type_id"
           name="secondary_education_education_type_id"
           value="{{secondary_education.education_type.id| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_education_type_adhoc"
           name="secondary_education_education_type_adhoc"
           value="{{secondary_education.education_type.adhoc| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_education_type_name"
           name="secondary_education_education_type_name"
           value="{{secondary_education.education_type.name| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_dipl_acc_high_educ"
           name="secondary_education_dipl_acc_high_educ"
           value="{{secondary_education.dipl_acc_high_educ}}" >
    <input type="hidden"
           id="hdn_secondary_education_path_repetition"
           name="secondary_education_path_repetition"
           value="{{secondary_education.path_repetition}}" >
    <input type="hidden"
           id="hdn_secondary_education_path_reorientation"
           name="secondary_education_path_reorientation"
           value="{{secondary_education.path_reorientation}}" >
    <input type="hidden"
           id="hdn_secondary_education_result"
           name="secondary_education_result"
           value="{{secondary_education.result | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_diploma"
           name="secondary_education_international_diploma"
           value="{{secondary_education.international_diploma | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_diploma_country_id"
           value="{{secondary_education.international_diploma_country.id}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_diploma_language"
           value="{{secondary_education.international_diploma_language| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_diploma_language_id"
           value="{{secondary_education.international_diploma_language.id}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_diploma_language_recognized"
           value="{{secondary_education.international_diploma_language.recognized | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_international_equivalence"
           name="secondary_education_international_equivalence"
           value="{{secondary_education.international_equivalence}}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam"
           name="secondary_education_admission_exam"
           value="{% if admission_exam %}True{% else %}False{% endif %}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_date"
           name="secondary_education_admission_exam_date"
           value="{{admission_exam.exam_date | default_if_none:'' | date:"d/m/Y" }}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_institution"
           name="secondary_education_admission_exam_institution"
           value="{{admission_exam.institution | default_if_none:'' }}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_type_id"
           name="secondary_education_admission_exam_type_id"
           value="{{admission_exam.admission_exam_type.id}}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_type_name"
           name="secondary_education_admission_exam_type_name"
           value="{{admission_exam.admission_exam_type.name}}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_type_adhoc"
           name="secondary_education_admission_exam_type_adhoc"
           value="{{admission_exam.admission_exam_type.adhoc}}" >
    <input type="hidden"
           id="hdn_secondary_education_admission_exam_result"
           name="secondary_education_admission_exam_result"
           value="{{admission_exam.result| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_professional_exam_date"
           name="secondary_education_professional_exam_date"
           value="{{professional_exam.exam_date | default_if_none:'' | date:"d/m/Y"}}" >
    <input type="hidden"
           id="hdn_secondary_professional_exam"
           name="secondary_education_professional_exam"
           value="{% if professional_exam %}True{% else %}False{% endif %}" >
    <input type="hidden"
           id="hdn_secondary_professional_exam_id"
           value="{{professional_exam.id | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_professional_exam_institution"
           name="secondary_education_professional_exam_institution"
           value="{{professional_exam.institution | default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_professional_exam_result"
           name="secondary_education_professional_exam_result"
           value="{{professional_exam.result| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_application_offer_year_id"
           value="{{application.offer_year.id| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_application_id"
           name="application_id"
           value="{{application.id| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_local_language_exam_needed"
           value="{{local_language_exam_needed}}" >
    <input type="hidden"
           id="hdn_secondary_education_local_language_exam"
           name="secondary_education_local_language_exam"
           value="{% if local_language_exam %}True{% else %}False{% endif %}" >
    <input type="hidden"
           id="hdn_secondary_education_local_language_exam_date"
           name="secondary_education_local_language_exam_date"
           value="{{local_language_exam.exam_date | default_if_none:'' | date:"d/m/Y" }}" >
    <input type="hidden"
           id="hdn_secondary_education_local_language_exam_institution"
           name="secondary_education_local_language_exam_institution"
           value="{{local_language_exam.institution| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_secondary_education_local_language_exam_result"
           name="secondary_education_local_language_exam_result"
           value="{{local_language_exam.result| default_if_none:''}}" >
    <input type="hidden"
           id="hdn_person_registration_id"
           value="{{application.applicant.registration_id| default_if_none:''}}" >
    {% csrf_token %}
    <div class="row">
        <div class="col-md-6">
            <h5>{% trans 'mandatory_asterisk'%}</h5>
        </div>
        <div class="col-md-6">
            <button type="submit" id="bt_validate_diploma" class="btn btn-default pull-right" role="button"
                    title="{%trans 'validate_data'%}"
                    name="validate_diploma" style="
                    {% if valid_data == True%}
                        background-color:#22f52b;
                    {%else%}
                        {% if valid_data == False %}
                            background-color:orange;
                        {%else%}
                            background-color:transparent;
                        {% endif %}
                    {% endif %}">
                    {% if valid_data == True%}
                        <span class="glyphicon glyphicon-ok-sign" aria-hidden="true"></span>
                    {%else%}
                        {% if valid_data == False %}
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true" ></span>
                        {%else%}
                            <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                        {% endif %}
                    {% endif %}

                {%trans 'validate_data'%}
            </button>

            <button type="submit" id="bt_submit_diploma" class="btn btn-default pull-right" role="button"
                    title="{%trans 'save'%}"
                    name="submit_diploma"
                    style="margin-right:10px;">
                <span class="glyphicon glyphicon-save" aria-hidden="true"></span>
                {%trans 'save'%}
            </button>
        </div>
    </div>


    <div class="row" style="margin-top:5px;">
        <div class="col-md-6">
            <a id="lnk_previous_step_up"
               class="btn btn-default"
               href="{%if application.id%}{% url 'applications' application.id %}{%else%}{% url 'applications'%}{%endif%}"
               onclick="save('form_secondary_education');"
               title="{% trans 'demandes'%}"><span class="glyphicon glyphicon-step-backward" aria-hidden="true"></span>
                {%trans 'previous_step'%} : {%trans 'offer_choice'%}</a>
        </div>
        <div class="col-md-6">
            <a id="lnk_next_step_up"
               class="btn btn-default pull-right"
               href="{%if application.id%}{% url 'curriculum_update' application.id%}{%else%}{% url 'curriculum_update'%}{%endif%}"
               onclick="save('form_secondary_education');"
               title="{% trans 'curriculum'%}">{%trans 'next_step'%} : {%trans 'curriculum'%}<span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span>
                </a>
        </div>
    </div>

    <div>
        <br>
        {%if validation_messages%}
            <div class="alert alert-warning" role="alert" style="margin-left:5px;" id="msg_validate_diploma">
                {% if validation_messages|length == 1 %}
                    {{ validation_messages|length}} {% trans 'validation_error'%}
                {%else%}
                     {% if validation_messages|length > 1 %}
                        {{ validation_messages|length}} {% trans 'validation_errors'%}
                     {% endif %}
                {% endif %}
                <ul style="visibility:hidden;display:none;">
                {%for msg in validation_messages%}
                    <li>{% trans msg %} : {{ validation_messages|get_item:msg}}</li>
                {% endfor%}
                </ul>

            </div>
        {% endif %}
        {% if valid_data == True %}
            <div class="alert alert-warning" role="alert" style="margin-left:5px;" id="msg_validat_data">
                 {% trans 'you_have_to_save' %}
            </div>
        {% endif %}
        {%if message_success%}
            <br>
            <span class="alert alert-success" role="alert" style="margin-left:5px;">
                {{message_success}}
            </span>
            <br><br>
        {% endif %}
    </div>
    <div class="panel panel-default"
         id="pnl_secondary_education_main">
        <div class="panel-heading">{% trans 'secondary_education' %}</div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12">
                    <label>{% trans 'question_get_diploma'%} *</label>
                    <br>
                    <span >{% trans 'label_secondary_education' %}</span>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="col-md-12">
                    <label class="radio-inline">
                      <input type="radio"
                             name="diploma"
                             id="rdb_diploma_true"
                             value="true"> {% trans 'yes'%}
                    </label>
                    <label class="radio-inline">
                      <input type="radio"
                             name="diploma"
                             id="rdb_diploma_false"
                             value="false"> {% trans 'no'%}
                    </label>
                    {%if validation_messages and validation_messages|get_item:'diploma'%}
                        <br><span class="error" style="margin-left:5px;">{{ validation_messages|get_item:'diploma'}}</span>
                    {% endif %}
                </div>
            </div>
            <br>
            <div id="pnl_academic_year"
                 class="form-inline">
                <div class="form-group" >
                    <label>{% trans 'pnl_academic_year_which_year'%} *</label>
                    <select class="form-control"
                            id="slt_academic_year"
                            name="academic_year"
                            onchange="show_hide_pnl_dipl_acc_high_educ();">
                            {% for academic_yr in academic_years %}
                                <option value="{{ academic_yr.id }}" title="{% trans 'academic_year'%}{{academic_yr.year}}">{{ academic_yr }}</option>
                            {% endfor %}
                    </select>
                    {%if validation_messages and validation_messages|get_item:'academic_year'%}
                        <span class="error" style="margin-left:5px;">
                            {{ validation_messages|get_item:'academic_year'}}
                        </span>
                    {% endif %}
                </div>
                <br><br>
                <div class="form-group" >
                    <label>
                      {% trans 'pnl_academic_year_secondary_education'%} *
                    </label>
                    <label class="radio-inline">
                      <input type="radio"
                             name="rdb_local_foreign" id="rdb_local"
                             value="true"
                             onclick="display('pnl_local_detail',true);display('pnl_foreign_detail',false);populate_secondary_national_institution();">&nbsp;{% trans 'in_belgium'%}
                    </label>
                    <label class="radio-inline">
                      <input type="radio"
                             name="rdb_local_foreign" id="rdb_foreign"
                             value="false"
                             onclick="display('pnl_local_detail',false);display('pnl_foreign_detail',true);">&nbsp;{% trans 'not_in_belgium'%}
                    </label>
                    {%if validation_messages and validation_messages|get_item:'rdb_localforeign'%}
                        <span class="error" style="margin-left:5px;">
                            {{ validation_messages|get_item:'rdb_local_foreign'}}
                        </span>
                    {% endif %}
                </div>
                <br>
                {% include "diploma/national_diploma.html" %}
                {% include "diploma/international_diploma.html" %}
            </div>
        </div>
    </div>
    {% include "diploma/admission_exam.html" %}
    {% include "diploma/professional_exam.html" %}
    {% include "diploma/local_language_exam.html" %}
    {%if validation_messages and validation_messages|get_item:'final'%}
        <br>
        <span class="error" style="margin-left:5px;">
            {{ validation_messages|get_item:'final'}}<br>
            <ul>
                <li>{{ validation_messages|get_item:'final1'}}</li>
                <li>{{ validation_messages|get_item:'final2'}}</li>
                <li>{{ validation_messages|get_item:'final3'}}</li>
            </ul>
        </span>
        <br><br>
    {% endif %}
    <br>
    <div>
        {%if message_success%}
            <br><br>
            <span class="alert alert-success" role="alert" style="margin-left:5px;">{{ message_success}}</span>
            <br><br>
        {% endif %}
    </div>

    <div class="row">
        <div class="col-md-6">
            <a id="lnk_previous_step"
               class="btn btn-default"
               href="{%if application.id%}{% url 'applications' application.id %}{%else%}{% url 'applications'%}{%endif%}"
               onclick="save('form_secondary_education');"
               title="{% trans 'demandes'%}"><span class="glyphicon glyphicon-step-backward" aria-hidden="true"></span>
                {%trans 'previous_step'%} : {%trans 'offer_choice'%}</a>
        </div>
        <div class="col-md-6">
            <a id="lnk_next_step"
               class="btn btn-default pull-right"
               href="{%if application.id%}{% url 'curriculum_update' application.id%}{%else%}{% url 'curriculum_update'%}{%endif%}"
               onclick="save('form_secondary_education');"
               title="{% trans 'curriculum'%}">{%trans 'next_step'%} : {%trans 'curriculum'%}<span class="glyphicon glyphicon-step-forward" aria-hidden="true"></span>
                </a>
        </div>
    </div>
</form>

  <script>
	var selDiv = "";

	document.addEventListener("DOMContentLoaded", init, false);

    function init(){
    }

	function handleFileSelect(e) {

		if(!e.target.files) return;

		selDiv.innerHTML = "<br/><p class='help-block'>Fichier sélectionné : </p>";

		var files = e.target.files;
		for(var i=0; i<files.length; i++) {
			var f = files[i];

			selDiv.innerHTML += f.name + "<br/>";

		}

	}

    function disabled_field_txt(id, state){
        if(state){
            document.getElementById(id).disabled = true;
        }else{
            document.getElementById(id).disabled = false;
        }
    }

    function disabled_reset_field_txt(id, state){

        if(state){
            document.getElementById(id).disabled = true;
        }else{
            document.getElementById(id).disabled = false;
        }
        document.getElementById(id).value="";
    }

    function display_or_hide(id,elt){
        display(id,elt.checked);
    }

    function show_hide_pnl_dipl_acc_high_educ(){
        var elt = document.getElementById('slt_academic_year');
        if (elt.selectedIndex == -1)
            return null;

        var s= elt.options[elt.selectedIndex].text;
        var pos = s.indexOf("-");
        var year=""
        if (pos > -1){
            year = s.substring(0,pos);
        }

        elt = document.getElementById('rdb_local_community_french');

        if(elt.checked){
            if(year < 1994){
                return display('pnl_dipl_acc_high_educ',true);
            }
        }
        elt = document.getElementById('rdb_local_community_dutch');
        if(elt.checked){
            if(year < 1992){
               return display('pnl_dipl_acc_high_educ',true);
            }
        }
        display('pnl_dipl_acc_high_educ',false);
    }

    function reset_rdb(elt_name){
        x=document.getElementsByName(elt_name);
        var i;
        for (i = 0; i < x.length; i++) {
            if (x[i].type == "radio") {
                x[i].checked = false;
            }
        }
    }

    function reset_radio(elt_name){
        x=document.getElementsByName(elt_name);
        var i;
        for (i = 0; i < x.length; i++) {

            if (x[i].type == "radio") {
                x[i].checked = false;
            }
        }
    }


    function reset_select(id){
        document.getElementById(id).selectedIndex = -1;
    }

    function enabled_other_language(elt){
        if(elt.checked){
            document.getElementById('slt_other_language_diploma').disabled = false;
            document.getElementById('slt_language_diploma').selectedIndex = 0;
            document.getElementById('slt_country').selectedIndex = 0;
            document.getElementById('slt_language_diploma').disabled=true;
            document.getElementById('slt_country').disabled=true;
            document.getElementById('pnl_translation').style="visibility:visible;display:block;";

        }else{
            document.getElementById('slt_other_language_diploma').disabled = true;
            document.getElementById('slt_other_language_diploma').selectedIndex = 0;
            document.getElementById('slt_language_diploma').disabled=false;
            document.getElementById('slt_country').disabled=false;
            document.getElementById('pnl_translation').style="visibility:hidden;display:none;";
        }
    }

    function delete_document(description){
        var data = new FormData();
        data.append('description', description);
        $.ajax({
            url: "{% url 'delete_document_file' %}",
            type: 'POST',
            data : data,
            processData: false,
            contentType: false

        });
        update_upload_btn_class('',description);
        return true;
    }

    </script>
